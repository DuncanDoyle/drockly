<!doctype html>
<html>
<head ng-cloak>
  <meta charset="utf-8">
  <title>Drockly</title>
  <meta name="description" content="Blockly-based block language for the Drools Rule Language">
  <meta name="viewport" content="width=device-width">

  <script src="../bower_components/jquery/dist/jquery.min.js"></script>
  <script src="../bower_components/jquery/dist/jquery.js"></script>
  <script src="../bower_components/jquery-ui/jquery-ui.js"></script>
  <link rel="stylesheet" href="../bower_components/jquery-ui/themes/ui-darkness/jquery-ui.css">

  <script type="text/javascript">
  $(function() {

      // Allows user to click Enter key in text field and it will submit the dialog
      /*
      $('#myDialog').keypress(function(e) {
          if (e.keyCode == $.ui.keyCode.ENTER) {
              getResponse();
          }
      });
      */

      /*
      var cancel = function() {
          $("#myDialog").dialog("close");
      }
      */


      //var getResponse = function() {
      //    var answer;
      //    /*// for radio-button selection
      //    $("input").each(function(){
      //      (this.checked == true) ? answer = $(this).val() : null;
      //    });
      //     */
      //
      //    answer = $("#first_name").val();
      //
      //    // This adds it dynamically
      //    // $("<p>").text(answer).insertAfter($("#poll"));
      //    $("#result").text(answer);
      //    $("#myDialog").dialog("close");
      //}

      //var dialogOpts = {
      //    modal : true,
      //    closeOnEscape : true,
      //    buttons : {
      //        "Done" : getResponse,
      //        "Cancel" : cancel
      //    },
      //    autoOpen : false
      //};
      //$("#myDialog").dialog(dialogOpts);
      //$("#poll").click(function() {
      //    $("#myDialog").dialog("open");
      //});


      //Dialog which displays the generated code.
      /*
      $('#generatedCodeDialog').keypress(function(e) {
          if (e.keyCode == $.ui.keyCode.ENTER) {
              //  getResponse();
          }
      });
      */
      /*
      var getResponse = function() {
        console.log("Getting response!");
        $("#generatedCodeDialog").dialog("close");
      }
      */

      //Generate code dialog
      var closeGeneratedCodeDialog = function() {
        $("#generatedCodeDialog").dialog("close");
      }

      var generatedCodeDialogOpts = {
          modal: true,
          closeOnEscape: true,
          width: "540",
          height: "600",
          buttons : {
            "OK" : closeGeneratedCodeDialog,
          },
          autoOpen : false
      }
      $("#generatedCodeDialog").dialog(generatedCodeDialogOpts);

      $("#generateCodeButton").click(function() {
        $("#generatedCodeTextArea").text(generateCode());
        $("#generatedCodeDialog").dialog("open");

      });

      //Save workspace
      var closeSaveWorkspaceDialog = function() {
        $("#saveWorkspaceDialog").dialog("close");
      }

      var saveWorkspaceDialogOpts = {
          modal: true,
          closeOnEscape: true,
          width: "540",
          height: "600",
          buttons : {
            "OK" : closeSaveWorkspaceDialog,
          },
          autoOpen : false
      }
      $("#saveWorkspaceDialog").dialog(saveWorkspaceDialogOpts);

      $("#saveWorkspaceButton").click(function() {
        $("#saveWorkspaceCodeTextArea").text(save());
        $("#saveWorkspaceDialog").dialog("open");
      });

      //Restore Workspace
      var closeLoadWorkspaceDialog = function() {
        $("#loadWorkspaceDialog").dialog("close");
      }

      var getResponseLoadWorkspaceDialog = function() {
          /*// for radio-button selection
          $("input").each(function(){
            (this.checked == true) ? answer = $(this).val() : null;
          });
           */

          var workspaceXml = $("#loadWorkspaceCodeTextArea").val();

          console.log("Loading workspace xml: " + workspaceXml);

          // This adds it dynamically
          // $("<p>").text(answer).insertAfter($("#poll"));
          load(workspaceXml);
          $("#loadWorkspaceDialog").dialog("close");
      }

      var loadWorkspaceDialogOpts = {
          modal: true,
          closeOnEscape: true,
          width: "540",
          height: "600",
          buttons : {
            "Load" : getResponseLoadWorkspaceDialog,
            "Cancel" : closeLoadWorkspaceDialog
          },
          autoOpen : false
      }
      $("#loadWorkspaceDialog").dialog(loadWorkspaceDialogOpts);

      $("#loadWorkspaceButton").click(function() {
        //$("#loadWorkspaceCodeTextArea").text(save());
        $("#loadWorkspaceDialog").dialog("open");
      });

  });
  </script>



  <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
  <!-- build:css(.) styles/vendor.css -->
  <!-- bower:css -->
  <!--
  <link rel="stylesheet" href="bower_components/bootstrap/dist/css/bootstrap.css" />
  -->
  <!-- endbower -->
  <!-- endbuild -->
  <!-- build:css(.tmp) styles/main.css -->
  <!--
  <link rel="stylesheet" href="styles/main.css">
-->
  <!-- endbuild -->
</head>

<body>
  <h1>Drockly: A blockly-based block language for DRL</h1>

  <!-- Blockly Div -->
  <div id="blocklyDiv" style="height: 480px; width: 1200px;">

  </div>
  <div id="blocklyButtons" style="height: 480px; width: 1200px;">
    <!--
    <button id="generateCode" onclick="generateCode()"> Generate code </button>
    -->
    <button id="generateCodeButton"> Generate code </button>
    <!--
    <button onclick="save()"> Save workspace </button>
    -->
    <button id="saveWorkspaceButton"> Save workspace </button>
    <button id="loadWorkspaceButton"> Load workspace </button>
  </div>

  <button id="poll">Poll</button>
  <div id="myDialog" class="flora" title="This is the title">
    <p>Question?</p>
    <label for="yes">Yes!</label><input type="radio" id="yes" value="yes25" name="question"><br>
    <label for="no">No!</label><input type="radio" id="no" value="no" name="question">
    <br/>
    First Name: <input type="text" id="first_name" />
  </div>


  <div id="generatedCodeDialog" class="flora" title="Generated Code">
    <textarea id="generatedCodeTextArea" rows="20" cols="60">
    </textarea>
  </div>

  <div id="saveWorkspaceDialog" class="flora" title="Save Workspace">
    <textarea id="saveWorkspaceCodeTextArea" rows="20" cols="60">
    </textarea>
  </div>

  <div id="loadWorkspaceDialog" class="flora" title="Load Workspace">
    <textarea id="loadWorkspaceCodeTextArea" rows="20" cols="60">
    </textarea>
  </div>

  <div style='color: green;' id='result'>
  </div>
  <!-- Blockly toolbox structure -->
  <xml id="toolbox" style="display: none">
    <category name="Drools" colout=100>
      <block type="drools_rule"></block>
      <block type="drools_property"></block>
      <block type="drools_object"></block>
      <block type="drools_constraint"></block>
      <block type="drools_string"></block>
      <block type="drools_number"></block>
      <block type="drools_drl"></block>
      <!--
      <block type="controls_if"></block>
      <block type="controls_repeat_ext"></block>
      <block type="logic_compare"></block>
      <block type="math_number"></block>
      <block type="math_arithmetic"></block>
      <block type="text"></block>
      <block type="text_print"></block>
    -->
    </category>
  </xml>




<!--
<body ng-cloak>
  <div class="header">
    <div class="navbar navbar-default" role="navigation">
      <div class="container">
        <div class="navbar-header">

          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#js-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>

          <a class="navbar-brand" href="#/">TicketApp</a>
        </div>

        <div class="collapse navbar-collapse" id="js-navbar-collapse">

          <ul class="nav navbar-nav">
            <li><a ng-href="/#/createTicket">Create Ticket</a></li>
            <li><a ng-href="/#/myTickets">My Tickets</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
            <li><a href="" ng-click="userLogout()">Log Out</a></li>
          </ul>
          <p class= "navbar-text navbar-right">{{currentUser.username}}</p>

        </div>
      </div>
    </div>
  </div>


  <div class="container">
    <div ng-view=""></div>
  </div>

-->

  <!-- build:js(.) scripts/vendor.js -->
  <!-- bower:js -->
  <!--
  <script src="bower_components/jquery/dist/jquery.js"></script>
  <script src="bower_components/angular/angular.js"></script>
  <script src="bower_components/bootstrap/dist/js/bootstrap.js"></script>
  <script src="bower_components/angular-route/angular-route.js"></script>
  <script src="bower_components/keycloak/dist/keycloak.js"></script>
  -->
  <!-- endbower -->
  <!-- endbuild -->

  <!-- build:js({.tmp,app}) scripts/scripts.js -->
  <!--
  <script src="scripts/config.js"></script>
  <script src="scripts/app.js"></script>
  <script src="scripts/controllers/main.js"></script>
  <script src="scripts/controllers/create.js"></script>
  <script src="scripts/controllers/mytickets.js"></script>
  <script src="scripts/controllers/ticket.js"></script>
  -->

  <script src="../bower_components/google-blockly/blockly_compressed.js"></script>
  <script src="../bower_components/google-blockly/blocks_compressed.js"></script>

  <!-- DRL blocks. -->
  <script src="blocks/drools.js"></script>
  <script src="generators/drools.js"></script>

  <script src="scripts/persistence.js"></script>

  <script src="../bower_components/google-blockly/msg/js/en.js"></script>
  <script>
    var workspace = Blockly.inject('blocklyDiv', {toolbox: document.getElementById('toolbox')});

  </script>


  <script>
    var generateCode =  function() {
      Blockly.Drools.addReservedWords('code');
      var code = Blockly.Drools.workspaceToCode(workspace);
      //alert("Drools code: \n\n" + code);
      return code;
    }

    var save =  function() {
      var xmlText = saveWorkspace(workspace);
      return xmlText;
      //alert("Workspace blocks XML: \n\n" + xmlText);
    }

    var load = function(xmlText) {
      loadWorkspace(xmlText, workspace);
    }
</script>

  <!-- endbuild -->
</body>
</html>
